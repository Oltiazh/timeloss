const DOMAINS={"google.com":0,"x.com":0,"youtube.com":0,"dl.nure.ua":0},DEFAULT_KEYS={PREV_DOMAIN_DATA:"prev_domain_data",DOMAIN_COUNTS:"domain_counts",UPDATE_TIME:"update_time",ACTIVE_DOMAIN:"active_domain",TRACKING:"tracking",AFK_INTERVAL:"afk_interval",POMODORO_ACTIVE:"pomodoro_active",POMODORO_TIME_PASSED:"pomodoro_time_passed"},UPDATE_INTERVAL=1;let intervalID,notificationID;const resetStorage=()=>{let t={};const e=(new Date).toLocaleDateString();Object.assign(t,{[DEFAULT_KEYS.DOMAIN_COUNTS]:DOMAINS,[DEFAULT_KEYS.UPDATE_TIME]:e,[DEFAULT_KEYS.ACTIVE_DOMAIN]:"",[DEFAULT_KEYS.TRACKING]:!0,[DEFAULT_KEYS.AFK_INTERVAL]:180,[DEFAULT_KEYS.PREV_DOMAIN_DATA]:{},[DEFAULT_KEYS.POMODORO_ACTIVE]:!1,[DEFAULT_KEYS.POMODORO_TIME_PASSED]:0}),chrome.storage.local.set(t)};function toDomain(t){return new URL(t).hostname.replace("www.","")}function checkTime(t){const e=(new Date).toLocaleDateString();return t!=e&&e}function makeNotification(t){clearNotification(),chrome.notifications.create({type:"basic",iconUrl:"icon.png",title:"Pomodoro",message:t},(t=>notificationID=t))}function clearNotification(){notificationID&&chrome.notifications.clear(notificationID)}function updateData(){chrome.storage.local.get(null,(t=>{t[DEFAULT_KEYS.TRACKING]&&chrome.idle.queryState(t[DEFAULT_KEYS.AFK_INTERVAL],(e=>{"active"===e&&chrome.tabs.query({active:!0,lastFocusedWindow:!0},(e=>{if(0===e.length)return;const E=toDomain(e[0].url);let o=Object.assign({},t[DEFAULT_KEYS.DOMAIN_COUNTS]||{}),a=t[DEFAULT_KEYS.POMODORO_TIME_PASSED]||0;const A=checkTime(t[DEFAULT_KEYS.UPDATE_TIME]);if("string"==typeof A){let e={};return Object.keys(o).forEach((t=>{o[t]=0})),Object.assign(e,{[DEFAULT_KEYS.ACTIVE_DOMAIN]:E,[DEFAULT_KEYS.AFK_INTERVAL]:t[DEFAULT_KEYS.AFK_INTERVAL],[DEFAULT_KEYS.DOMAIN_COUNTS]:o,[DEFAULT_KEYS.POMODORO_ACTIVE]:t[DEFAULT_KEYS.POMODORO_ACTIVE],[DEFAULT_KEYS.POMODORO_TIME_PASSED]:0,[DEFAULT_KEYS.PREV_DOMAIN_DATA]:Object.assign({},{[t[DEFAULT_KEYS.UPDATE_TIME]]:t[DEFAULT_KEYS.DOMAIN_COUNTS],...t[DEFAULT_KEYS.PREV_DOMAIN_DATA]}),[DEFAULT_KEYS.TRACKING]:t[DEFAULT_KEYS.TRACKING],[DEFAULT_KEYS.UPDATE_TIME]:A}),chrome.storage.local.clear(),void chrome.storage.local.set(e)}t[DEFAULT_KEYS.POMODORO_ACTIVE]&&(1500===a?makeNotification("Rest time: 5 min"):1800===a&&(makeNotification("Work time: 25 min"),a=-1),a+=UPDATE_INTERVAL),E in o&&(o[E]+=UPDATE_INTERVAL),chrome.storage.local.set({[DEFAULT_KEYS.DOMAIN_COUNTS]:o,[DEFAULT_KEYS.ACTIVE_DOMAIN]:E,[DEFAULT_KEYS.POMODORO_TIME_PASSED]:a})}))}))}))}function startInterval(){intervalID=setInterval(updateData,1e3)}function clearIntervalIfExists(){intervalID&&clearInterval(intervalID)}chrome.runtime.onInstalled.addListener(resetStorage),startInterval(),chrome.runtime.onMessage.addListener(((t,e,E)=>{"resetInterval"===t&&(clearIntervalIfExists(),startInterval(),E({status:"Interval reset"}))}));